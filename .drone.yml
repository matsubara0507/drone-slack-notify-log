kind: pipeline
name: default

clone:
  depth: 5

steps:
  - name: build go
    image: golang:1.12
    commands:
      - go build
      - GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -a -tags netgo -o release/linux/amd64/drone-git-notify-log

  - name: blackbox test
    image: golang:1.12
    environment:
      SLACK_TOKEN:
        from_secret: slack_token
      PLUGIN_CHANNEL: "bot-test"
      DRONE_TOKEN:
        from_secret: drone_token
      DRONE_HOST: "https://cloud.drone.io"
      PLUGIN_STEP_NUMBER: 2
    commands:
      - ./drone-git-notify-log
